---
title: "zenn scrap 編集場所"
emoji: "✨"
type: "" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# 11週目 オリジナル講義(?) データベース設計基礎
RDB(リレーショナルデータベース)について学ぶ

- データベースを学ぶ理由
アプリケーションの複雑性や保守性に大きく影響を与える部分であるため
また、パフォーマンスに大きく影響を与える
- データベースの良くない例
・凡庸的に扱えない
    データ型が揃っていない、定義できないものなど
・実装を考えていない
    一つのカラムで色々な意味を持つ(コメントを入れないとどんな処理かわからない)
    新しいデータが増えた際に全ての処理を見直す必要がある
-> より良いデータベース設計が行われれば、コードをシンプルに保つことが出来る

**設計工程**
```mermaid
graph LR
   概念設計 --> 論理設計 --> 物理設計
```

- **概念設計**
どんな情報の塊が必要かを考える
(例) 生徒の成績を管理するシステム
→ 生徒、成績、教科の3つのデータ管理が必要そう
→ それぞれのデータがどのように関連付けしているかも考える(ER図)

https://qiita.com/ramuneru/items/32fbf3032b625f71b69d

- **論理設計**
概念設計のエンティティ構造をデータベースが扱いやすい構造に変形させる
→ どんなテーブルにどんな属性(カラム)を持つかを考える
    - 正規化
    矛盾したデータが発生しないようにテーブルを分割していく作業
    - 間数従属性
    「ある列Xの値が決まれば自ずと列Yの値も定まる」関係のことを、「列Yは列Xに関数従属している」という

    - 非正規形 ~ 第三正規形
    ```mermaid
    graph LR
    第一正規形 --> 第二正規形 --> 第三正規形
    ```
    第一正規形: 全ての属性は単一値である
    第二正規形: 第一正規形であり、全ての非キー属性は、いかなる候補キーにも部分関数従属していない```部分関数従属:主キーの一部に関数従属している```
    第三正規形: 第二正規形であり、全ての非キー属性は、いかなる候補キーにも推移的関数従属していない```推移的関数従属: 関数従属が推移的に行われている```
    → 第三正規形したつもりで分割したことによる発生する問題点として、あるデータを変更すると過去に登録したデータも変化してしまう(変化する可能性のある数値データなどはその時のデータとして保持するか、新しいIDを発番するなどして対策を講じる)

    - 連関エンティティ(中間テーブル、結合テーブル)
    新しいテーブルを追加して、複数のデータを紐づけること

- **物理設計**
データベースに保存するためにはどうすればよいか
DBMSを利用するために必要な詳細な設計を決定していく
→ 物理名、型、制約、インデックスの決定など

物理設計は各DBMSの特性を理解している必要がある(Oracle, MySQL, PostgreSQLなど)

- 物理名の命名規則
    テーブル名は複数形(例: users)
    日時は xxxx_at, 日付は xxxx_on
    true(1)が何か予測しやすい is_xxxx
プログラムの中で使えることを意識して命名する

- NULLの罠
    計算や文字列結合時にNULLを使用すると、結果がNULLとなる
    COALESCE(X, 0)とすることで、XがNULLならば0を返すと指定できる
計算、条件、グルーピング、並び替えなどに使用する列はできる限りNULLを許容するべきでない
→ NOT NULL制約を使う

# 重要キーワード
- なぜデータベース設計が重要で慎重に行うべきか

- 論理設計、物理設計とはそれぞれ何を行うか

- 主キーとは何か、どんな性質を備えているか
レコードを一位に特定できるものとして用いる列、またはその集合のことである
主キーが持つべき特性
        → 必ずデータが格納されている(NULLでない)
        → 他の行と値が重複しない(ユニークである)
```複合主キー: 複数の列で構成される主キーのこと```
(```候補キー: 行を一意に識別することのできる最小限の組み合わせ → 主キーの候補```) 
```自然キー: データベースに投入する前に既に実在(自然に存在)していて、値で主キーの役割を果たせるもの```
```人口キー: 管理目的のために人為的に追加された列のこと```

- 一事実一箇所の原則とはどのようなものか
データの生合成を保つためには、一つの事実は一箇所に保存するべきといった原則
→ 一つのデータを更新した際に、矛盾が生じないようにするため

- 正規化とは何か
矛盾したデータが発生しないようにテーブルを分割していく作業のこと
```第一正規化: 繰り返しの排除```
```第二正規化: 部分関数従属の排除```
```第三正規化: 推移的関数従属の排除```
正規化を行うデメリット
→ テーブルの結合処理に時間(コスト)がかかる
→ アプリケーションが(一部)複雑になる
    トランザクションを行うことが大事
- 物理名と論理名の違いは何か
論理名とは、人間にとってわかりやすいように表記したものである
物理名とは、システムに設定するために表記したものである
# グループワーク
**テーブル設計(論理設計)してみよう**
>テーブル設計は次のように示す
>テーブル名(主キー*、カラム1、カラム2、カラム3)
>テーブル名(複合主キー1*、複合主キー2*、カラム1、カラム2、カラム3)
>
>- 現在の仕様
>現在、ユーザ登録を行い、短文の文章を投稿できる掲示板アプリがある
>テーブル設計は次の通りである
>ユーザ(ユーザID*、メールアドレス、パスワード、ユーザ名、登録日時、退会フラグ)
>投稿(投稿ID*、ユーザID、投稿文、投稿日時)
>
>- 改修要件
>・ユーザがお互いをフォローできる(フォローを行うとそのユーザの登録を簡単に閲覧可能である)
 >   フォロー数やフォロワー(フォローされている)数に制限はない
 >   過去にフォローしていたかどうかは履歴として保持する必要はない
>
>改修要件を実現するためにどのようなテーブルやカラムが必要になるか論理設計を行う。
